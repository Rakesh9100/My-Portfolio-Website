---
import { Image } from "astro:assets";
import logo from "../assets/images/logo.png";

const navItems = [
    { href: '#home', label: 'HOME' },
    { href: '#about', label: 'ABOUT' },
    { href: '#skills', label: 'SKILLS' },
    { href: '#experience', label: 'EXPERIENCE' },
    { href: '#projects', label: 'PROJECTS' },
    { href: '#certificates', label: 'CERTIFICATIONS' },
    { href: '#contact', label: 'CONTACT' },
];
---

<nav class="navbar">
    <div class="navbar-container">
        <!-- Logo -->
        <a href="#home" aria-label="Go to home" class="logo-link">
            <Image src={logo} alt="Rakesh Roshan logo" width={200} height={60} class="img-logo" />
        </a>

        <!-- Desktop Menu -->
        <ul class="menu">
            {navItems.map((item, index) => {
                const isActive = index === 0 ? ' active' : '';
                return (
                    <li class="menu-item">
                        <a href={item.href} class={`nav-link${isActive}`}>
                            {item.label}
                        </a>
                    </li>
                );
            })}
        </ul>

        <!-- Right Section -->
        <div class="navbar-right">
            <!-- Resume Button -->
            <a href="/assets/Rakesh_Roshan_Resume.pdf" target="_blank" rel="noopener noreferrer" aria-label="Open resume in new tab" class="resume-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="resume-icon">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span class="resume-text">Resume</span>
            </a>

            <!-- Theme Switcher -->
            <div class="theme-switcher" id="theme-switcher">
                <button class="theme-toggle-btn" id="theme-toggle-btn" aria-label="Toggle Theme Switcher">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" fill="currentColor">
                        <path d="M512 256c0 .9 0 1.8 0 2.7c-.4 36.5-33.6 61.3-70.1 61.3H344c-26.5 0-48 21.5-48 48c0 3.4 .4 6.7 1 9.9c2.1 10.2 6.5 20 10.8 29.9c6.1 13.8 12.1 27.5 12.1 42c0 31.8-21.6 60.7-53.4 62c-3.5 .1-7 .2-10.6 .2C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM128 288a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm0-96a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm96 96a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/>
                    </svg>
                </button>
                <div class="theme-options" id="theme-options">
                    <button class="theme-btn active" data-theme="sunset">
                        <span class="theme-color theme-sunset"></span>
                        <span class="theme-name">Sunset</span>
                    </button>

                    <button class="theme-btn" data-theme="midnight">
                        <span class="theme-color theme-midnight"></span>
                        <span class="theme-name">Midnight</span>
                    </button>

                    <button class="theme-btn" data-theme="forest">
                        <span class="theme-color theme-forest"></span>
                        <span class="theme-name">Forest</span>
                    </button>
                </div>
            </div>

            <!-- Mobile menu button -->
            <button class="menu-btn" id="menu-toggle" aria-label="Toggle Menu">
                <svg class="hamburger" fill="currentColor" viewBox="0 0 448 512">
                    <path d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"/>
                </svg>
                <svg class="close hidden" fill="currentColor" viewBox="0 0 384 512">
                    <path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-content">
            <ul class="mobile-menu-list">
                {navItems.map((item, index) => {
                    const isActive = index === 0 ? ' active' : '';
                    return (
                        <li class="mobile-menu-item">
                            <a href={item.href} class={`mobile-nav-link${isActive}`}>
                                {item.label}
                            </a>
                        </li>
                    );
                })}
            </ul>
        </div>
    </div>
</nav>

<style>
    .logo-link,
    .menu a,
    .navbar-right a {
        user-select: none;
        -webkit-user-drag: none;
    }

    .navbar {
        position: fixed;
        width: 100%;
        z-index: 999;
        padding: 4px 32px;
    }

    .navbar-container {
        max-width: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 5px 16px;
        border-radius: 50px;
        position: relative;
        background: rgba(11, 15, 26, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .logo-link {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 8px;
        min-width: 90px;
        transition: transform 0.4s ease;
    }

    .logo-link:hover {
        transform: translateY(-1px);
    }

    .img-logo {
        height: 100%;
        max-height: 40px;
        width: auto;
        object-fit: contain;
        pointer-events: none;
    }

    .menu {
        display: flex;
        list-style: none;
        gap: 5px;
    }

    .nav-link {
        position: relative;
        display: inline-flex;
        font-weight: bold;
        padding: 10px 16px;
        border-radius: 15px;
        overflow: hidden;
        box-sizing: border-box;
        transition: transform 0.4s ease;
        font-size: clamp(10px, 1.3vw, 16px);
        line-height: 1;
        outline: none;
        border: none;
    }

    .nav-link:hover {
        transform: translateY(-4px);
    }

    .nav-link::before {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0;
        border-radius: 15px;
        transition: opacity 0.5s ease;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15));
    }

    .nav-link:hover::before {
        opacity: 1;
    }

    .navbar .menu li a.active {
        background: var(--navbar);
        border-radius: 15px;
    }

    .navbar-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .resume-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 14px;
        text-decoration: none;
        border: 2px solid transparent;
        transition: background 0.3s ease;
        background: linear-gradient(rgba(11,15,26,0.9), rgba(11,15,26,0.9)) padding-box, var(--navbar) border-box;
    }

    .resume-btn:hover {
        background: linear-gradient(rgba(11,15,26,0.9), rgba(11,15,26,0.9)) padding-box, var(--gradient1) border-box;
    }

    @keyframes bounceDown {
        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(5px);
        }
    }

    .resume-btn:hover svg {
        animation: bounceDown 0.6s ease infinite;
    }

    .resume-icon {
        width: 18px;
        height: 18px;
    }

    .theme-toggle-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.3s ease;
        background: color-mix(in srgb, var(--primary) 20%, transparent);
        border: 2px solid color-mix(in srgb, var(--primary) 60%, transparent);
    }

    .theme-options {
        position: absolute;
        top: 55px;
        right: 0;
        border-radius: 15px;
        padding: 14px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        background: rgba(11, 15, 26, 0.95);
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .theme-btn {
        width: 100%;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 16px;
        margin-bottom: 8px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.3s ease;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .theme-btn:hover {
        transform: translateX(-5px);
        border: 1px solid var(--hover);
        background: rgba(255, 255, 255, 0.12);
    }

    .theme-btn.active {
        border: 1px solid var(--primary);
        background: color-mix(in srgb, var(--primary) 25%, transparent);
    }

    .theme-color {
        width: 30px;
        height: 30px;
        display: block;
        border-radius: 50%;
    }

    /* Theme Colors */
    .theme-sunset {
        background: var(--navbar);
    }

    .theme-midnight {
        background: linear-gradient(135deg, #3498db 0%, #4CA1AF 100%);
    }

    .theme-forest {
        background: linear-gradient(135deg, #3a9d5d 0%, #71B280 100%);
    }

    .menu-btn {
        display: none;
        font-size: 24px;
        background: none;
        border: none;
        cursor: pointer;
        position: relative;
        transition: transform 0.3s ease;
    }

    .menu-btn:hover {
        transform: scale(1.1);
    }

    .hamburger,
    .close {
        width: 25px;
        height: 25px;
    }

    .hidden {
        display: none;
    }

    .mobile-menu::-webkit-scrollbar {
        width: 6px;
    }

    .mobile-menu {
        display: none;
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        opacity: 0;
        z-index: 999;
        padding: 0 16px;
        overflow-y: auto;
        visibility: hidden;
        max-height: calc(100vh - 90px);
        transition: all 0.3s ease;
        transform: translateY(-20px);
    }

    .mobile-menu-content {
        border-radius: 25px;
        overflow: hidden;
        background: rgba(11, 15, 26, 0.98);
    }

    .mobile-menu-list {
        margin: 0;
        padding: 16px;
        list-style: none;
    }

    .mobile-menu-item {
        margin-bottom: 8px;
    }

    .mobile-nav-link {
        display: block;
        text-align: center;
        font-weight: bold;
        padding: 12px 16px;
        border-radius: 14px;
        text-decoration: none;
        transition: background-color 0.3s ease;
        font-size: 14px;
    }

    .mobile-nav-link:hover {
        background-color: color-mix(in srgb, var(--primary) 15%, transparent);
    }

    .mobile-nav-link.active {
        background: var(--gradient1) !important;
        border: 1px solid var(--secondary);
    }

    @media (max-width: 1100px) {
        .nav-link {
            padding: 10px 12px;
        }
    }

    @media (max-width: 1024px) {
        .navbar {
            padding: 4px 14px;
        }

        .navbar-container {
            padding: 5px 10px;
        }

        .menu {
            gap: 3px;
        }

        .resume-btn span {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .navbar {
            padding: 4px 20px;
        }

        .navbar-container {
            padding: 5px 16px;
        }

        .menu {
            display: none;
        }

        .menu-btn {
            display: block;
            margin-left: 14px;
        }

        .mobile-menu,
        .resume-btn span {
            display: block;
        }

        .mobile-menu-content {
            border: 2px solid var(--ternary);
        }

        .mobile-nav-link {
            background: rgba(255, 255, 255, 0.14);
        }

        .nav-link:hover,
        .mobile-nav-link:hover,
        .theme-btn:hover {
            transform: translateY(0);
        }
    }

    @media (max-width: 640px) {
        .navbar-container {
            padding: 5px 12px;
        }

        .navbar-right {
            gap: 4px;
        }

        .resume-btn {
            padding: 8px 12px;
            font-size: 12px;
        }

        .mobile-menu {
            top: 65px;
        }
    }

    @media (max-width: 375px) {
        .resume-btn span {
            display: none;
        }
    }
</style>

<script>
    // Generic toggle function for UI elements
    function createToggleHandler(toggleBtn: HTMLElement | null, targetElement: HTMLElement | null, openTransform = '') {
        let isOpen = false;

        const open = () => {
            if (!targetElement) return;
            isOpen = true;
            targetElement.classList.add('active');
            targetElement.style.opacity = '1';
            targetElement.style.visibility = 'visible';
            targetElement.style.transform = 'translateY(0)';
            if (openTransform && toggleBtn) {
                toggleBtn.style.transform = openTransform;
            }
        };

        const close = () => {
            if (!targetElement) return;
            isOpen = false;
            targetElement.classList.remove('active');
            targetElement.style.opacity = '0';
            targetElement.style.visibility = 'hidden';
            targetElement.style.transform = 'translateY(-10px)';
            if (toggleBtn) {
                toggleBtn.style.transform = '';
            }
        };

        const toggle = () => isOpen ? close() : open();

        return { open, close, toggle, isOpen: () => isOpen };
    }

    // Theme switcher setup
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const themeOptions = document.getElementById('theme-options');
    const themeButtons = document.querySelectorAll('.theme-btn');

    const themeHandler = createToggleHandler(
        themeToggleBtn,
        themeOptions,
        'scale(1.1) rotate(180deg)'
    );

    // Mobile menu setup
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const hamburgerIcon = menuToggle?.querySelector('.hamburger');
    const closeIcon = menuToggle?.querySelector('.close');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

    let isMenuOpen = false;

    function openMenu() {
        if (!mobileMenu) return;
        isMenuOpen = true;
        mobileMenu.style.opacity = '1';
        mobileMenu.style.visibility = 'visible';
        mobileMenu.style.transform = 'translateY(0)';
        hamburgerIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        if (!mobileMenu) return;
        isMenuOpen = false;
        mobileMenu.style.opacity = '0';
        mobileMenu.style.visibility = 'hidden';
        mobileMenu.style.transform = 'translateY(-20px)';
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
    }

    function toggleMenu() {
        isMenuOpen ? closeMenu() : openMenu();
    }

    // Event listeners
    menuToggle?.addEventListener('click', (e) => {
        e.stopPropagation();
        if (themeHandler.isOpen()) themeHandler.close();
        toggleMenu();
    });

    mobileMenu?.addEventListener('click', (e) => e.stopPropagation());

    mobileNavLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
    });

    themeToggleBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        if (isMenuOpen) closeMenu();
        themeHandler.toggle();
    });

    themeOptions?.addEventListener('click', (e) => e.stopPropagation());

    // Theme management
    const savedTheme = localStorage.getItem('theme') || 'sunset';
    document.documentElement.setAttribute('data-theme', savedTheme);

    themeButtons.forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-theme') === savedTheme);

        btn.addEventListener('click', () => {
            const theme = btn.getAttribute('data-theme');
            if (theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                themeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                themeHandler.close();
            }
        });
    });

    // Global click handler
    document.addEventListener('click', () => {
        if (isMenuOpen) closeMenu();
        if (themeHandler.isOpen()) themeHandler.close();
    });

    // Navigation handling
    const sections = document.querySelectorAll('section[id]');
    const allNavLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
    let isUserNavigating = false;
    let navigationTimeout: ReturnType<typeof setTimeout> | null = null;

    function setActiveLink(targetHref: string) {
        allNavLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === targetHref);
        });
    }

    allNavLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            const href = link.getAttribute('href');
            if (href) {
                if (navigationTimeout) clearTimeout(navigationTimeout);

                isUserNavigating = true;
                setActiveLink(href);

                navigationTimeout = setTimeout(() => {
                    isUserNavigating = false;
                    navigationTimeout = null;
                }, 1500);

                setTimeout(() => (e.target as HTMLElement).blur(), 100);
            }
        });
    });

    function handleHashNavigation() {
        const hash = window.location.hash || '#home';
        setActiveLink(hash);
    }

    const observer = new IntersectionObserver(
        (entries: IntersectionObserverEntry[]) => {
            if (isUserNavigating) return;

            let bestEntry: IntersectionObserverEntry | undefined;
            let maxRatio = 0;

            for (const entry of entries) {
                if (entry.isIntersecting && entry.intersectionRatio > maxRatio) {
                    maxRatio = entry.intersectionRatio;
                    bestEntry = entry;
                }
            }

            if (bestEntry) {
                const id = bestEntry.target.getAttribute('id');
                if (id) setActiveLink(`#${id}`);
            }
        }, {
            threshold: [0.1, 0.3, 0.5, 0.7],
            rootMargin: '-20% 0px -20% 0px'
        }
    );

    handleHashNavigation();
    window.addEventListener('hashchange', handleHashNavigation);
    sections.forEach(section => observer.observe(section));
</script>